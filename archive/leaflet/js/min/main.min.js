$(document).ready(function(){function e(e){console.log("ajax data: ",e);var n=["2005","2006","2007","2008","2009","2010","2011","2012"],i=["percentChange"],t=1/0,r=-1/0;for(var o in e.features){var a=e.features[o].properties;for(var c in a)"id"!=c&&"name"!=c&&"lat"!=c&&"lon"!=c&&"percentChange"!=c&&(-1===$.inArray(n)&&n.push(c),a[c]<t&&(t=a[c]),a[c]>r&&(r=a[c]))}return{timestamps:n,percent:i,min:t,max:r}}function n(e,n){c=L.geoJson(n,{pointToLayer:function(e,n){return L.circleMarker(n,{fillColor:"#53868B",color:"#2F4F4F",weight:1,fillOpacity:.6}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#D1EEEE"})},mouseout:function(){this.closePopup(),this.setStyle({color:"#2F4F4F"})}})}}).addTo(b),i(e[0])}function i(e){c.eachLayer(function(n){var i=n.feature.properties,r=t(i[e]),o="<b>"+String(i[e])+"%</b> of commuters biked<br> in <b> "+i.name+"</b> in </b>"+e;n.setRadius(r),n.bindPopup(o,{offset:new L.Point(0,-r)})})}function t(e){var n=700,i=e*n;return Math.sqrt(i/Math.PI)}function r(e,n){function i(e){return.5*Math.round(e/.5)}.5>e&&(e=.5);var r=L.control({position:"topright"});r.onAdd=function(){var r,o,a,c=L.DomUtil.create("div","legend"),b=L.DomUtil.create("div","symbolsContainer"),p=[i(e),i((n-e)/2.75),i(n)],l=0;L.DomEvent.addListener(c,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(c).append("<h3 id='legendTitle'>% OF COMMUTERS</h3>");for(var s=0;s<=p.length-1;s++)r=L.DomUtil.create("div","legendCircle"),o=t(p[s]),a=-o-l-2,$(r).attr("style","width: "+2*o+"px; height: "+2*o+"px; margin-left: "+a+"px"),$(r).append("<span class='legendValue'>"+p[s]+"<span>"),$(b).append(r),l=o;return $(c).append(b),c},r.addTo(b)}function o(e){var n=L.control({position:"bottomleft"});n.onAdd=function(){var n=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(n,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(n).attr({type:"range",max:e[e.length-1],min:e[0],step:1,value:String(e[0])}).on("input change",function(){i($(this).val().toString()),$(".temporal-legend").text(this.value)}),n},n.addTo(b),a(e[0])}function a(e){var n=L.control({position:"bottomleft"});n.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},n.addTo(b),$(".temporal-legend").text(e)}function t(e){var n=700,i=e*n;return Math.sqrt(i/Math.PI)}console.log("oh hi!");var c,b=L.map("map",{center:[39.5,-98.35],zoom:4,minZoom:3});b.setMaxBounds([[30,-140],[49,-36]]),L.Control.Fullscreen,L.tileLayer("https://{s}.tiles.mapbox.com/v3/natalieroseamend.jinjgdb7/{z}/{x}/{y}.png",{attribution:'Tiles © Mapbox © Open Street Mapping | Data from 2005-2012 <a href="http://www.census.gov/acs/www/">American Community Surveys</a>'}).addTo(b),console.log("tiles added"),$.getJSON("data/bike2.json").done(function(i){var t=e(i);n(t.timestamps,i),r(t.min,t.max),o(t.timestamps)}).fail(function(){alert("There has been a problem loading the data.")}),customCircleMarker=L.CircleMarker.extend({options:{percentShift:100}});var p=new customCircleMarker([38.8951,-77.0367],{percentShift:122,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>122%</b> in <b>Washington, D.C.</b><br>between 2005 and 2012."),l=new customCircleMarker([33.45,-112.0667],{percentShift:27,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>27%</b> in <b>Tuscan</b><br>between 2005 and 2012."),s=new customCircleMarker([47.6097,-122.3331],{percentShift:78,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>78%</b> in <b>Seattle</b><br>between 2005 and 2012."),d=new customCircleMarker([37.7833,-122.4167],{percentShift:111,fillOpacity:0}).bindPopup("Biking increased <b>111%</b> in <b>San Francisco</b><br>between 2005 and 2012."),u=new customCircleMarker([45.52,-122.6819],{percentShift:74,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>74%</b> in <b>Portland</b><br>between 2005 and 2012."),f=new customCircleMarker([39.95,-75.1667],{percentShift:156,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>156%</b> in <b>Philadelphia</b><br>between 2005 and 2012."),m=new customCircleMarker([40.7127,-74.0059],{percentShift:100,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>100%</b> in <b>New York City</b><br>between 2005 and 2012."),h=new customCircleMarker([29.9667,-90.05],{percentShift:140,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>140%</b> in <b>New Orleans</b><br>between 2005 and 2012."),g=new customCircleMarker([44.9833,-93.2667],{percentShift:88,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>88%</b> in <b>Minneapolis</b><br>between 2005 and 2012."),v=new customCircleMarker([43.05,-87.95],{percentShift:50,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>50%</b> in <b>Milwaukee</b><br>between 2005 and 2012."),w=new customCircleMarker([25.7877,-80.2241],{percentShift:100,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>100%</b> in <b>Miami</b><br>between 2005 and 2012."),k=new customCircleMarker([34.05,-118.25],{percentShift:67,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>67%</b> in <b>Los Angeles</b><br>between 2005 and 2012."),O=new customCircleMarker([42.3314,-83.0458],{percentShift:200,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>200%</b> in <b>Detroit</b><br>between 2005 and 2012."),y=new customCircleMarker([39.7392,-104.9847],{percentShift:107,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>107%</b> in <b>Denver</b><br>between 2005 and 2012."),M=new customCircleMarker([41.8819,-87.6278],{percentShift:129,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>129%</b> in <b>Chicago</b><br>between 2005 and 2012."),C=new customCircleMarker([42.3581,-71.0636],{percentShift:200,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>122%</b> in <b>Boston</b><br>between 2005 and 2012."),S=new customCircleMarker([30.25,-97.75],{percentShift:23,riseOnHover:!0,fillOpacity:0}).bindPopup("Biking increased <b>23%</b> in <b>Austin</b><br>between 2005 and 2012."),P=L.layerGroup([p,l,s,d,u,f,m,h,g,v,w,k,O,y,M,C,S]),B={"% Change, 2005 to 2012":P};L.control.layers(null,B,{collapsed:!1}).addTo(b)});